//必须设置domianname
if(domainname == undefined){
	console.log("var domainname is not set");
};

//新版PC订单流程 lc 2014.06.13
var  pcOrderCookie = {
    cookieList:["advistor_info", "destlist", "subdestlist", "destdays", "triplist", "peoplenum", "userinfo", "submitorder"]
};
//清除所有cookie
pcOrderCookie.clearCookie = function() {
    for( var i in this.cookieList ) {
        this.storageSave( this.cookieList[i], null );
    }
    return true;
};
//保存cookie
pcOrderCookie.storageSave = function( key, value ) {
    var string = $.isPlainObject( value ) ? JSON.stringify(value) : value;
    $.cookie( key, string, {expires:30, path:'/',domain:"."+domainname} );
    return true;
};
//检测cookie
pcOrderCookie.checkCookie = function () {
    for( var i in this.cookieList ) {
            var jsonStr = $.cookie( this.cookieList[i] );
            if( jsonStr )
                return true;
    }
    return false;
};

//首页Banner背景图片变换 2014/07/02 lc
$(function () {
    var _index = 1;
    var _time = 4000;
    var _imgLength = $("#pic_list>li").length;

    if( 0 == _imgLength )
        return;

    var _timerId = setInterval(function () {
        autofocus(_index); _index++; if (_index == _imgLength) {
                _index = 0;
        }
    }, _time);

    $("#control_list>li").find("a").hover(function () {
            clearInterval(_timerId);
        }, function () {
            _timerId = setInterval(function () {
                autofocus(_index); _index++; if (_index == _imgLength) {
                    _index = 0;
                }
            }, _time);
        }).mouseover(function () {
            _index = $(this).parent().index();
            autofocus(_index);
    });

    function autofocus(_index) {
        var $li = $("#pic_list>li").eq(_index);
        $li.fadeIn("slow").siblings().hide();
        var rel = $li.attr("rel");
        if( _index && !rel) {
            $li.attr("rel", "1");
            var $img = $li.find("img");
            $img.attr("src", $img.attr("original"));
        }

        var $ol = $("#control_list>li").eq(_index);
        $ol.find("a").addClass("flex-active");
        $ol.siblings().find("a").removeClass("flex-active");
    }
});

//幻灯插件
(function($){
    $.fn.slide=function(){
        var $this=$(this);
        var beginFlag = 0;
        var prevFlag = 0;
        var currFlag = 0;
        var endFlag = 0;
        var Time_Out = 5000;
        var fadeInTime = 300;
        var Slide_Id;
        $this.find(".CarNavList span").each(function(index, element){
            endFlag = index*1;
            $(element).mouseover(function(){
                clearTimeout(Slide_Id);
                var _CurrFlag = parseInt($(this).attr("flag"));
                if (_CurrFlag==currFlag) {
                    return;
                }
                prevFlag = currFlag;
                currFlag = _CurrFlag;
                slide_title();
            }).mouseout(function(){Slide_Id=setTimeout(start_slide, Time_Out);});
        });
        function fadeIn_Out(curObj){
            $this.find(".Slide_Images li").hide();
            curObj.fadeIn(fadeInTime);
        }
        function slide_pic() {
            $this.find(".Slide_Images li").each(function(index, element){
                if (index==currFlag) {
                    fadeIn_Out($(element));
                }
            });
        }
        function slide_title() {
            $this.find(".CarNavList span").each(function(index, element){
                if (index==currFlag) {
                    $(element).removeClass("tab-current").addClass("tab-current");
                } else {
                    $(element).removeClass("tab-current");
                }
                $('div.CarTitleList a').hide().eq(currFlag).show();
            });
            slide_pic();
        }
        function start_slide() {
            prevFlag = currFlag;
            if (currFlag==endFlag) {
                currFlag=beginFlag;
            } else {
                currFlag = currFlag*1+ 1;
            }
            slide_title();
            Slide_Id=setTimeout(start_slide, Time_Out);
        }
        Slide_Id=setTimeout(start_slide, Time_Out);
    }
})(jQuery);
//图片自动滚动
function DY_scroll(_wraper,_prev,_next,_img,_speed,or){
    var wraper = $(_wraper);
    var prev = $(_prev);
    var next = $(_next);
    var img = $(_img).find('ul');
    var w = img.find('li').outerWidth(true);
    var s = _speed;
    var _function = {};
    _function.Prev = function(){
        img.find('li:last').prependTo(img);
        img.css({
            'margin-left':-w
        });
        img.animate({
            'margin-left':0
        });
    };
    _function.Next = function(){
        img.animate({
            'margin-left':-w
        },function(){
            img.find('li').eq(0).appendTo(img);
            img.css({
                'margin-left':0
            });
        });
    };
    next.click(function(){
        _function.Next();
    });
    prev.click(function(){
        _function.Prev();
    });

    if (or == true){
        ad = setInterval(function() {
            _function.Next();
        },s*1000);
        wraper.hover(function(){
            clearInterval(ad);
        },function(){
            ad = setInterval(function() {
                _function.Next();
            },s*1000);
        });
    }
}

var SiteTool = window.SitePassport||{};
SiteTool={
    getQueryString:function(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return 'login_status';
    }
};
var SitePassport=window.SitePassport||{};
SitePassport={
    showStatus:function(src){
        if(document.cookie.indexOf('unick=')!=-1){
            $.ajax({
                url:'/passport/getIsLogin',
                dataType:"jsonp",
                jsonp:"callback",
                success:function(data){
                    login_status(data);
                }
            });
        }
    }
};
function login_status(obj){
    if(typeof(obj)=='object'){
        if(typeof(obj['uinfo'])=='object'){
            var html_arr = new Array();
            html_arr.push('<ul class="sub-nav"><li><a href="/my" title="'+obj['uinfo']['shortnick']+'">'+obj['uinfo']['shortnick']);
            if(parseInt(obj['uinfo']['msg_count'])>0){
                html_arr.push('(<i class="cpure">'+obj['uinfo']['msg_count']+'</i>)');
            }
            html_arr.push('</a></li>');
            html_arr.push('<li><a href="/orderc/authview" target="_blank">查询订单</a></li>');
            html_arr.push('<li><a href="javascript:logout();">[退出]</a></li>');
            html_arr.push('</ul>');
            $('#hello_box').html(html_arr.join(''));
        }
    }
}

//是否读取登录后要跳转的地址
function to_login(tourl,readv){
    if(!readv){
        ref_url = location.href;
    }else{
        ref_url = document.getElementById('login_after_url').value;
    }
    location.href=tourl+"?ref="+encodeURIComponent(ref_url).replace(/\//g,"%2F");
    return false;
}
function logout(){
    ref_url = location.href;
    location.href="/passport/logout?ref="+encodeURIComponent(ref_url).replace(/\//g,"%2F");
    return false;
}
function islogin(ref_url,showbox){
    $.getJSON( "/passport/isLoginAjax",
        function(json){
            if(parseInt(json['st'])==1){
                if(ref_url){
                    location.href= ref_url;
                }
            }else{
                if(showbox==undefined){
                    showbox = true;
                }
                if(showbox){
                    if(ref_url){
                        $('#login_after_url').val(ref_url);
                    }
                    $.colorbox({
                        open:true,
                        inline:true,
                        href:"#login_box",
                        width:"550px"
                    });
                }
            }
        });
    return false;
}

function is_cookie_unick(){
    if(document.cookie.indexOf('unick=')!=-1){
        return true;
    }
    return false;
}

function _init_dest(){
    $("div.choose-box2").hover(
        function(){
            $(this).addClass("hover");
            $('#chose_btn').removeClass('choose-box').addClass('choose-ds-down');
        },
        function(){
            $(this).removeClass("hover");
            $('#chose_btn').removeClass('choose-ds-down').addClass('choose-box');
        }
        );
}

function lazyloading(){
    $(".lazyimg img").lazyload({threshold:150});
}

function lazyimg(){
    $("img.lazy").lazyload({threshold:150});
}
var _time_ = 0;
function _hide_loign_box(){
    $('#login_box_show').hide();
}
//目的地弹框中标签切换
function _selectFlag(type,obj){
    $(obj).siblings().removeClass('s-tab-over');
    $(obj).addClass('s-tab-over');
    $(obj).parents('.s-drop-top').siblings('.s-drop-cont').hide().siblings('.selected_'+type).show();
}
//单击滚动到顶部
function scroll_top(){
    $("a.bar_backtotop").click(function() {
        $("body,html").animate({
            scrollTop:0
        },800);
        return false;
    });
}
//搜索弹框
function _valid(type){
    var obj = '';
    var str = '';
    if(type == 1){
        obj = $('#search_wanto');
        str = obj.val();
    }else{
        obj = $('#_search_wanto');
        str = obj.val();
    }
    if(!str){
        obj.focus();
        return false;
    }else{
        if(str == '搜线路' || str=='输入你想去的目的地'){
            obj.focus();
            return false;
        }else{
            return true;
        }
    }
}
//单击页面非弹框处 关闭搜索弹框
function _auto_shut(){
    $(document).click(function(event){
      var e = event || window.event;
      var click_tag = e.target || e.srcElement;
      while(click_tag.tagName != "BODY"){
          var obj = $(click_tag);
          if(obj.hasClass('pop-window') || obj.hasClass('pop-window-ele')){
              return;
          }
          click_tag = click_tag.parentNode;
      }
      $('div.pop-window-ele').hide();
    });
}
//理念弹层
function show_information(is_click){
	return;
    if(!is_click){
        if($.cookie('_first')){
            return false;
        }else{
            $.cookie('_first','1',{expires:30,path: '/',domain:domainname})
        }
    }
    $.getScript('/statics/js/jquery/jquery.colorbox-min.js',function(){
        var tip_interval;
        $.colorbox({
            fixed:true,
            html:'<div class="concept" id="6renyou_information"><div class="concept-tit"><div class="ccp-left"><i>6人游</i>专注小团高品质旅游</div><div class="ccp-right"><span class="ccp-time">还剩<i>6</i>秒消失</span></div></div><div class="concept-cont"></div><div class="iknow"><span onclick="$.colorbox.close();">我知道了</span></div></div>',
            width:"900px",
            height:"420px"
        });
        tip_interval = setInterval(function(){
            var second_obj = $('#6renyou_information span.ccp-time i').eq(0);
            var second_str = second_obj.html();
            if(!isNaN(second_str)){
                var second = parseInt(second_str);
                second = second-1;
                if(second<=0){
                    clearInterval(tip_interval);
                    $.colorbox.close();
                }else{
                    second_obj.html(second);
                }
            }else{
                clearInterval(tip_interval);
                $.colorbox.close();
            }
        },1000);
    });
}
function format_date(str){
    var arr = str.split('-');
    if(arr[1].length<2){
        arr[1] = '0'+arr[1];
    }
    if(arr[2].length<2){
        arr[2] = '0'+arr[2];
    }
    return arr.join('-');
}
//表单
function setForm(obj_str){
    if(!obj_str){
        obj_str = '#form_stoken'
    }
    $.ajax({
          type:'post',
          url:'/orderc/getFormToken',
          data:{},
          dataType:'json',
          success:function(res){
            if(parseInt(res.status) == 1){
              $(obj_str).html('<input type="hidden" name="stoken" value="'+res['data']['tk']+'" />');
            }else{
              //
            }
          }
        });
}
function new_date(str) {
    if(isNaN(str)){
        str = str.split('-');
        var date = new Date();
        date.setUTCFullYear(str[0], str[1] - 1, str[2]);
        date.setUTCHours(0, 0, 0, 0);
    }else{
        var date = new Date(str);
    }
    return date;
}
function focus_input(t){
    if($(t).val()==$(t).attr('d')){
        $(t).val('');
        $(t).removeClass('cc');
    }
}
function blur_input(t){
    if($(t).val()==''){
        $(t).val($(t).attr('d'));
        $(t).addClass('cc');
    }
}
function call_bdbridge(){
    if(typeof no_call_bdbridge == 'boolean' && no_call_bdbridge){
        $('div.float-side').hide();
        return false;
    }
    var $lightboxOverlay = $("#bdsq_lightboxOverlay");
    var $window_box = $("#bdsq_window_box");
    var $window = $(window);
    $(".showDiv").click(function(){
        $("body,html").animate({
            scrollTop:0
        },800);
        $window_box.find('.bdbridge-pop-box').html('<iframe frameborder="0" scrolling="no" style="width:800px;height:600px;" src="http://qiao.baidu.com/v3/?module=default&controller=im&action=index&ucid=6827408&type=n&siteid=3769295" name="bdbridge-frame"></iframe>')
        $window_box.fadeIn("fast",function(){
            $lightboxOverlay.width($(document).width()).height($(document).height());
            $lightboxOverlay.fadeTo(500,0.7);
        });
        top = $window.scrollTop() + $window.height() / 10;
        left = $window.scrollLeft();
        $window_box.css({top: top + "px"});
    });
    $(".window_close,#bdsq_lightboxOverlay").click(function(){
        $lightboxOverlay.fadeOut();
        $window_box.fadeOut();
    });
}
function set_adult_cnt(t,type) {
    var form_obj = $(t).parents('form');
    var adult_cnt_input = form_obj.find('input[name="adult_cnt"]').eq(0);
    var val = isNaN(adult_cnt_input.val()) ? 0 : parseInt(adult_cnt_input.val());
    if (type == '-') {
        if (val > 1) {
            val = val - 1;
        }
    } else if (type == '+') {
        val = val + 1;
    }
    adult_cnt_input.val(val);
}
function check_add_corder(t,type) {
    var form_obj = $(t);
    var destination_input = form_obj.find('input[name="destination"]').eq(0);
    if (destination_input.val() == '' || destination_input.val() == destination_input.attr('d')) {
        destination_input.focus();
        show_error(destination_input,'请输入目的地');
        return false;
    }
    var realname_input = form_obj.find('input[name="realname"]').eq(0);
    if (realname_input.val() == '' || realname_input.val() == realname_input.attr('d')) {
        realname_input.focus();
        show_error(realname_input,'请输入姓名');
        return false;
    }
    var mobile_input = form_obj.find('input[name="mobile"]').eq(0);
    var mobile_val = mobile_input.val();
    var mobile_test = /^13[0-9]{9}|15[0-9]{9}|18[0-9]{9}$/;
    if (mobile_val.length != 11 || !mobile_test.test(mobile_val) || mobile_input.val() == mobile_input.attr('d')) {
        mobile_input.val('');
        mobile_input.focus();
        show_error(mobile_input,'请输入正确的手机号');
        return false;
    }
    var adult_cnt_input = form_obj.find('input[name="adult_cnt"]').eq(0);
    if (isNaN(adult_cnt_input.val()) || adult_cnt_input.val() < 1) {
        adult_cnt_input.focus();
        if(adult_cnt_input.parents('div.tc-send-input').length==1){
            show_error(adult_cnt_input.parents('div.tc-send-input'),'请选择出行人数');
        }
        return false;
    }
    setTimeout(function(){
        destination_input.val('');
        realname_input.val('');
        mobile_input.val('');
    },500);
    return true;
}


function show_error(t,error){
    var obj = $(t);
    var pos_arr = obj.offset();
    var error_pop_obj = $('#input-pop-error-div');
    error_pop_obj.find('p.pop-prompt-txt').html(error);
    error_pop_obj.css({'top':pos_arr.top-obj.height(),'left':(pos_arr.left+obj.width()*2/3)});
    error_pop_obj.show();
    setTimeout(function(){error_pop_obj.hide()},2000)
}
function get_url_param(k) {
    var _v = location.search.match(new RegExp("[\?\&]" + k + "=([^\&]*)(\&?)", "i"));
    return _v ? _v[1] : null;
}
function del_advistor(){
    var expire_d = new Date();
    expire_d.setTime(expire_d.getTime() -1000)
    var expired_time = expire_d.toGMTString();
    document.cookie = "advistor_info='';expires=" + expired_time+";path=/;domain="+domainname;
    //document.cookie = "order_info='';expires=" + expired_time+";path=/;domain=6renyou.com";
    pcOrderCookie.clearCookie();
    close_advistor();
}
function close_advistor(){
    $('#hello_box ul.sub-nav li.p-rt div.chat-tips-pop').remove();
}
function tip_advistor(){
    if(typeof no_tip_advistor == 'boolean' && no_tip_advistor) return false;
    var a = "advistor_info";
    var advistor_cookie_str = '';
    var pos = document.cookie.indexOf(a+'=');
    var tip_cookie_obj = {};
    if (pos === -1){
        return false;
        /*var a = "order_info";
        var advistor_cookie_str = '';
        var pos = document.cookie.indexOf(a+'=');
        if(pos===-1){
            return false;
        }else{
            var pos2 = document.cookie.indexOf(';',pos);
            if(pos2 === -1) {
                advistor_cookie_str = decodeURIComponent(document.cookie.substring( pos + a.length + 1));
            } else {
                advistor_cookie_str = decodeURIComponent(document.cookie.substring( pos + a.length + 1,pos2));
            }
            var tip_cookie_list = advistor_cookie_str.split('|');
            tip_cookie_obj['des'] = tip_cookie_list[2];
            if(tip_cookie_list[3]){
                tip_cookie_obj['who_together'] = tip_cookie_list[3];
            }
        }*/
    } else {
        var pos2 = document.cookie.indexOf(';',pos);
        if(pos2 === -1) {
            advistor_cookie_str = decodeURIComponent(document.cookie.substring( pos + a.length + 1));
        } else {
            advistor_cookie_str = decodeURIComponent(document.cookie.substring( pos + a.length + 1,pos2));
        }
        var tip_cookie_list = advistor_cookie_str.split('&&');
        var tip_cookie_len = tip_cookie_list.length;

        for (var i = 0; i < tip_cookie_len; i++) {
            var cookie_one = tip_cookie_list[i].split('=');
            if(cookie_one[0]){
              tip_cookie_obj[cookie_one[0]] = cookie_one[1];
            }
        };
    }
    if(tip_cookie_obj['dest'] && location.href!='http://www.6renyou.com/ordercext/index'){
        var tip_arr = new Array();
        tip_arr.push('<li class="p-rt">');
            tip_arr.push('<a href="/ordercext/index" class="left">我的咨询</a>');
            tip_arr.push('<span class="chat-tip-icon"></span>');
            tip_arr.push('<div class="chat-tips-pop">');
                tip_arr.push('<a class="pop-close" href="#" onclick="close_advistor();return false;"></a>');
                tip_arr.push('<div class="chat-pop-box radius5">');
                    tip_arr.push('<p>目的地：<span>'+tip_cookie_obj['dest']+'</span></p>');
                    if(tip_cookie_obj['days']){
                        tip_arr.push('<p>天数：<span>'+(tip_cookie_obj['days'])+'</span></p>');
                    }
                    tip_arr.push('<div class="chat-pop-opr">');
                        tip_arr.push('<a href="#" onclick="del_advistor();return false;" class="cancel-chat-btn"><span>取消咨询</span></a>');
                        tip_arr.push('<a href="/ordercext/index" class="goahead-btn radius5"><span>继续咨询</span></a>');
                    tip_arr.push('</div>');
                tip_arr.push('</div>');
                tip_arr.push('<span class="pop-pointer-top"><b class="b1">◆</b><b class="b2">◆</b></span>');
            tip_arr.push('</div>');
        tip_arr.push('</li>');
        setTimeout(function(){
            $('#hello_box ul.sub-nav').prepend(tip_arr.join(''));
        },500);
    }
}

function show_trip_detail(_id,sn){
    if($('#pop_trip_detail').length==0){
        $.ajax({
            url:"http://www.6renyou.com/orderc/tripDetail?id="+_id+"&sn="+sn,
            type:"get",
            success:function(res){
                if($('#pop_trip_detail').length==0){
                    $("body").append(res);
                    $('#pop_trip_detail span.W_close').click(function(){
                        $('#pop_trip_detail').remove();
                        $('#pop_trip_detail_layer').remove();
                    });
                    var content_height = $('#pop_trip_detail_layer').height()-145;
                    if(content_height>$('#pop_trip_detail div.xingcheng-field').height()){
                        $('#pop_trip_detail div.xingcheng-field').height(content_height);
                    }
                }
            }
        });
    }
}
//弹出层
function custom_alert(title,content,callback){
    if($('#custom_alert_content').length!=0){
        $('#custom_alert_content').remove();
        $('#custom_alert_layer').remove();
    }
    title = title?title:'操作提示';
    var alert_arr = new Array();
    alert_arr.push('<div class="alert_W_float" id="custom_alert_layer"></div>');
    alert_arr.push('<div class="alert_W_outer"  id="custom_alert_content">');
        alert_arr.push('<div class="alert_W_box">');
            alert_arr.push('<div class="alert_W_title"><h1>'+title+'</h1><span class="alert_W_close"></span></div>');
            alert_arr.push('<div class="alert_W_field">');
                alert_arr.push('<div class="alert_W_txt1">'+content+'</div>');
            alert_arr.push('</div>');
            alert_arr.push('<div class="alert_W_opr"><span class="btn-base btn-pure-h24">确定</span></div>');
        alert_arr.push('</div>');
    alert_arr.push('</div>');
    $('body').append(alert_arr.join(''));
    $('#custom_alert_layer,#custom_alert_content span.alert_W_close').click(function(){
        $('#custom_alert_content').remove();
        $('#custom_alert_layer').remove();
    });
    if(typeof callback =='function'){
        callback();
    }else if(callback){
        eval(callback);
    }else{
        $('#custom_alert_content div.alert_W_opr span.btn-base').click(function(){
            $('#custom_alert_content').remove();
            $('#custom_alert_layer').remove();
        });
    }
}